Ext.define("Ext.ux.CheckColumn",{extend:"Ext.grid.column.Column",alias:"widget.checkcolumn",stopSelection:true,tdCls:Ext.baseCSSPrefix+"grid-cell-checkcolumn",constructor:function(){this.addEvents("beforecheckchange","checkchange");this.checkboxDisable=arguments[0].checkboxDisable;this.callParent(arguments)},processEvent:function(g,i,m,b,h,d,c,n){if(this.checkboxDisable){d.stopEvent();return false}var f=this,l=g==="keydown"&&d.getKey(),a=g=="mousedown";if(a||(l==d.ENTER||l==d.SPACE)){var j=f.dataIndex,k=!c.get(j);if(f.fireEvent("beforecheckchange",f,b,k)!==false){c.set(j,k);f.fireEvent("checkchange",f,b,k);if(a){d.stopEvent()}if(!f.stopSelection){i.selModel.selectByPosition({row:b,column:h})}return false}else{return !f.stopSelection}}else{return f.callParent(arguments)}},renderer:function(e,c,b,g,d){var f=Ext.baseCSSPrefix,a=[f+"grid-checkheader"];if(e){a.push(f+"grid-checkheader-checked")}if(this.columns[d].checkboxDisable){a.push(f+"grid-checkheader-disable")}return'<div class="thumb chex"><table><tr><td><div class="'+a.join(" ")+'">&#160;</div></td></tr></table></div>'}});Ext.define("Podyozhiki.ux.DownloadColumn",{extend:"Ext.grid.column.Column",alias:"widget.downloadcolumn",constructor:function(){if(!window.mbDownloadColumnGlobal){window.mbDownloadColumnGlobal={clickdowload:this._onClickDowload}}this.callParent(arguments)},renderer:function(e,c,b,f,d){if(e.length===0){return""}console.log(e);if(e.access){var a='<div class="thumb"><table><tr><td><img data-objectId="'+e.objectId+'" data-type="'+e.objectType+'" onclick="mbDownloadColumnGlobal.clickdowload(event)" class="download_column_opacity_true" src="/images/icons/downloads_true.png" style="width:24px; height:24px;"></td></tr></table></div>'}else{var a='<div class="thumb"><table><tr><td><img class="download_column_opacity_false" src="/images/icons/downloads_false.png" style="width:24px; height:24px;"></td></tr></table></div>'}return a},_onClickDowload:function(d){d=d||window.event;var b=d.target||d.srcElement;var c=b.getAttribute("data-type");var e=b.getAttribute("data-objectId");Ext.Ajax.request({url:"/downloads/export",method:"GET",params:{objectId:e,objectType:c,comment:"",onlyAllowed:1},success:function(a,f){var g=Podyozhiki.utils.ErrorHandler.checkResult(a.responseText);if(g){if(g.link){window.location.replace(g.link)}else{Ext.MessageBox.alert("Ошибка получения объекта","Не достаточно прав для данной операции.")}}},failure:function(a,f){Podyozhiki.utils.ErrorHandler.serverError()}})}});Ext.define("Ext.ux.layout.Center",{extend:"Ext.layout.container.Fit",alias:"layout.ux.center",percentRe:/^\d+(?:\.\d+)?\%$/,itemCls:"ux-layout-center-item",initLayout:function(){this.callParent(arguments);this.owner.addCls("ux-layout-center")},getItemSizePolicy:function(a){var b=this.callParent(arguments);if(typeof a.width=="number"){b=this.sizePolicies[b.setsHeight?2:0]}return b},getPos:function(b,d,c){var a=b.props[c]+d.margins[c],e=Math.round((d.targetSize[c]-a)/2);return Math.max(e,0)},getSize:function(b,d,c){var a=b[c];if(typeof a=="string"&&this.percentRe.test(a)){a=parseFloat(a)/100}else{a=b[c+"Ratio"]}return d.targetSize[c]*(a||1)-d.margins[c]},positionItemX:function(a,c){var b=this.getPos(a,c,"width");a.setProp("x",b)},positionItemY:function(a,c){var b=this.getPos(a,c,"height");a.setProp("y",b)},setItemHeight:function(b,c){var a=this.getSize(b.target,c,"height");b.setHeight(a)},setItemWidth:function(b,c){var a=this.getSize(b.target,c,"width");b.setWidth(a)}});Ext.define("Podyozhiki.utils.ErrorHandler",{singleton:true,checkResult:function(a){var b=Ext.decode(a);if(!b.success){console.log(b);if(b.errorCode==1){window.location.replace("http://"+window.location.host.toString()+"/user/login")}else{Ext.Msg.show({title:"Ошибка",msg:b.errorMessage,width:300,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}return false}else{if(b.data){return b.data}else{return true}}},checkResultStore:function(a){if(!a.success){if(a.errorCode==1){window.location.replace("http://"+window.location.host.toString()+"/user/login")}else{Ext.Msg.show({title:"Ошибка",msg:a.errorMessage,width:300,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}}},serverError:function(){Ext.Msg.show({title:"Ошибка",msg:"Запрос не выполнен. Ошибка на стороне сервера.",width:300,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}});Ext.define("Podyozhiki.admin.model.Diploms",{extend:"Ext.data.Model",fields:[{name:"printed",type:"int"},{name:"id",type:"int"},{name:"name",type:"string"},{name:"surname",type:"string"},{name:"region_name",type:"string"},{name:"score",type:"int"}],editItem:function(b){console.log("editItem");var a=Ext.widget("diploms_edit_form",{param:b});a.center();a.show()}});Ext.define("Podyozhiki.admin.model.Encourages",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"type",type:"string"},{name:"item_text",type:"string"}],deleteItem:function(a){Ext.Msg.confirm("Удаление","Вы действительно хотите удалить &laquo;подбадривание&raquo;?",function(b,c){if(b=="yes"){Ext.Ajax.request({url:"./deleteEntity.php",method:"POST",params:{id:a,entity:"encourage"},success:function(d,e){if(Podyozhiki.utils.ErrorHandler.checkResult(d.responseText)){Ext.getCmp("encourages_grid").getStore("Encourages").load();Ext.getCmp("encourages_del").disable();Ext.getCmp("encourages_edit").disable()}},failure:function(d,e){Podyozhiki.utils.ErrorHandler.serverError();Ext.getCmp("encourages_edit_form").close()}})}},this)},editItem:function(b){console.log("editItem");var a=Ext.widget("encourages_edit_form",{param:b});a.center();a.show()}});Ext.define("Podyozhiki.admin.model.Photo",{extend:"Ext.data.Model",fields:[{name:"name",type:"string"},{name:"surname",type:"string"},{name:"region_name",type:"string"}]});Ext.define("Podyozhiki.admin.model.Photos",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"region_id",type:"string"},{name:"region_name",type:"string"},{name:"score",type:"int"}],deleteItem:function(a){Ext.Msg.confirm("Удаление","Вы действительно хотите удалить фотографию?",function(b,c){if(b=="yes"){Ext.Ajax.request({url:"./deleteEntity.php",method:"POST",params:{id:a,entity:"photo"},success:function(d,e){if(Podyozhiki.utils.ErrorHandler.checkResult(d.responseText)){Ext.getCmp("photos_grid").getStore("Photos").load();Ext.getCmp("photos_del").disable();Ext.getCmp("photos_edit").disable()}},failure:function(d,e){Podyozhiki.utils.ErrorHandler.serverError();Ext.getCmp("photos_edit_form").close()}})}},this)},editItem:function(b){console.log("editItem");var a=Ext.widget("photos_edit_form",{param:b});a.center();a.show()}});Ext.define("Podyozhiki.admin.model.Region",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"name",type:"string"}]});Ext.define("Podyozhiki.admin.model.Results",{extend:"Ext.data.Model",fields:[{name:"position",type:"int"},{name:"number",type:"int"},{name:"name",type:"string"},{name:"surname",type:"string"},{name:"region_name",type:"string"},{name:"score",type:"int"}]});Ext.define("Podyozhiki.admin.model.Stand",{extend:"Ext.data.Model",fields:[{name:"name",type:"string"},{name:"surname",type:"string"},{name:"region_name",type:"string"},{name:"points",type:"string"}]});Ext.define("Podyozhiki.admin.model.Stands",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"region_id",type:"string"},{name:"region_name",type:"string"},{name:"score",type:"int"}],deleteItem:function(a){Ext.Msg.confirm("Удаление","Вы действительно хотите удалить стенд?",function(b,c){if(b=="yes"){Ext.Ajax.request({url:"./deleteEntity.php",method:"POST",params:{id:a,entity:"stand"},success:function(d,e){if(Podyozhiki.utils.ErrorHandler.checkResult(d.responseText)){Ext.getCmp("stands_grid").getStore("Stands").load();Ext.getCmp("stands_del").disable();Ext.getCmp("stands_edit").disable()}},failure:function(d,e){Podyozhiki.utils.ErrorHandler.serverError();Ext.getCmp("stands_edit_form").close()}})}},this)},editItem:function(b){console.log("editItem");var a=Ext.widget("stands_edit_form",{param:b});a.center();a.show()}});Ext.define("Podyozhiki.admin.model.Users",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"number",type:"int"},{name:"name",type:"string"},{name:"surname",type:"string"},{name:"description",type:"string"},{name:"region_id",type:"string"},{name:"theme1_points",type:"string"},{name:"theme2_points",type:"string"},{name:"theme3_points",type:"string"},{name:"theme4_points",type:"string"},{name:"theme5_points",type:"string"},{name:"theme6_points",type:"string"},{name:"theme7_points",type:"string"},{name:"theme8_points",type:"string"},{name:"theme9_points",type:"string"},{name:"theme10_points",type:"string"},{name:"region_name",type:"string"},{name:"points_left",type:"int"},{name:"voted_for_photo",type:"string"},{name:"voted_for_person",type:"string"},{name:"score",type:"int"}],deleteItem:function(a){Ext.Msg.confirm("Удаление","Вы действительно хотите удалить пользователя?",function(b,c){if(b=="yes"){Ext.Ajax.request({url:"./deleteEntity.php",method:"POST",params:{id:a,entity:"person"},success:function(d,e){if(Podyozhiki.utils.ErrorHandler.checkResult(d.responseText)){Ext.getCmp("users_grid").getStore("Users").load();Ext.getCmp("users_del").disable();Ext.getCmp("users_edit").disable()}},failure:function(d,e){Podyozhiki.utils.ErrorHandler.serverError();Ext.getCmp("users_edit_form").close()}})}},this)},editItem:function(b){console.log("editItem");var a=Ext.widget("users_edit_form",{param:b});a.center();a.show()}});Ext.define("Podyozhiki.admin.store.Diploms",{extend:"Ext.data.Store",model:"Podyozhiki.admin.model.Diploms",autoLoad:false,autoSync:false,root:"data",remoteSort:false,proxy:{type:"ajax",actionMethods:{read:"GET"},api:{read:"./topUsersGame.php?diploms=1"},reader:{type:"json",root:"data",messageProperty:"errorMessage",successProperty:"success"}}});Ext.define("Podyozhiki.admin.store.Encourages",{extend:"Ext.data.Store",model:"Podyozhiki.admin.model.Encourages",autoLoad:false,autoSync:false,root:"data",remoteSort:false,proxy:{type:"ajax",actionMethods:{read:"GET"},api:{read:"./getEntitys.php?entity=encourage"},reader:{type:"json",root:"data",messageProperty:"errorMessage",successProperty:"success"}}});Ext.define("Podyozhiki.admin.store.Photo",{extend:"Ext.data.Store",model:"Podyozhiki.admin.model.Photo",autoLoad:true,autoSync:false,root:"data",remoteSort:false,proxy:{type:"ajax",actionMethods:{read:"POST"},api:{read:"./getPhotoInfo.php"},reader:{type:"json",root:"data",messageProperty:"errorMessage",successProperty:"success"},extraParams:{id:0}}});Ext.define("Podyozhiki.admin.store.Photos",{extend:"Ext.data.Store",model:"Podyozhiki.admin.model.Photos",autoLoad:false,autoSync:false,root:"data",remoteSort:false,proxy:{type:"ajax",actionMethods:{read:"GET"},api:{read:"./getEntitys.php?entity=photo"},reader:{type:"json",root:"data",messageProperty:"errorMessage",successProperty:"success"}}});Ext.define("Podyozhiki.admin.store.Region",{extend:"Ext.data.Store",model:"Podyozhiki.admin.model.Region",autoLoad:true,autoSync:false,root:"data",remoteSort:false,proxy:{type:"ajax",actionMethods:{read:"GET"},api:{read:"./getEntitys.php?entity=region"},reader:{type:"json",root:"data",messageProperty:"errorMessage",successProperty:"success"}}});Ext.define("Podyozhiki.admin.store.Results",{extend:"Ext.data.Store",model:"Podyozhiki.admin.model.Results",autoLoad:false,autoSync:false,root:"data",remoteSort:false,proxy:{type:"ajax",actionMethods:{read:"GET"},api:{read:"./topUsersVote.php"},reader:{type:"json",root:"data",messageProperty:"errorMessage",successProperty:"success"}}});Ext.define("Podyozhiki.admin.store.Stand",{extend:"Ext.data.Store",model:"Podyozhiki.admin.model.Stand",autoLoad:true,autoSync:false,root:"data",remoteSort:false,proxy:{type:"ajax",actionMethods:{read:"POST"},api:{read:"./getStandInfo.php"},reader:{type:"json",root:"data",messageProperty:"errorMessage",successProperty:"success"},extraParams:{id:0}}});Ext.define("Podyozhiki.admin.store.Stands",{extend:"Ext.data.Store",model:"Podyozhiki.admin.model.Stands",autoLoad:false,autoSync:false,root:"data",remoteSort:false,proxy:{type:"ajax",actionMethods:{read:"GET"},api:{read:"./getEntitys.php?entity=stand"},reader:{type:"json",root:"data",messageProperty:"errorMessage",successProperty:"success"}}});Ext.define("Podyozhiki.admin.store.Users",{extend:"Ext.data.Store",model:"Podyozhiki.admin.model.Users",autoLoad:false,autoSync:false,root:"data",remoteSort:false,proxy:{type:"ajax",actionMethods:{read:"GET"},api:{read:"./getEntitys.php?entity=user"},reader:{type:"json",root:"data",messageProperty:"errorMessage",successProperty:"success"}}});Ext.define("Podyozhiki.admin.view.Diploms",{extend:"Ext.form.Panel",alias:"widget.diploms",id:"diploms",region:"center",layout:"border",border:false,hideMode:"visibility",hidden:true,items:[{xtype:"gridpanel",id:"diploms_grid",store:"Podyozhiki.admin.store.Diploms",margin:1,region:"center",autoHeight:true,autoScroll:true,border:false,sortableColumns:true,viewConfig:{loadingText:"Загрузка...",stripeRows:false,getRowClass:function(a){return a.get("printed")?"":"red"}},columns:[{header:"ID",dataIndex:"id",hidden:true,sortable:false,flex:1},{header:"Напечатан",dataIndex:"printed",hidden:true,flex:1},{header:"Имя",dataIndex:"name",sortable:false,flex:1},{header:"Фамилия",dataIndex:"surname",sortable:false,flex:1},{header:"Регион",dataIndex:"region_name",sortable:false,flex:1},{header:"Набрано баллов",dataIndex:"score",sortable:false,flex:0.5}]}],initComponent:function(){console.log("init view Diploms");this.callParent(arguments)}});Ext.define("Podyozhiki.admin.view.DiplomsEditForm",{extend:"Ext.window.Window",alias:"widget.diploms_edit_form",id:"diploms_edit_form",title:"Данные для диплома",closable:true,constrain:true,maximizable:false,modal:true,width:550,height:240,layout:"border",bodyPadding:5,resizable:false,closeAction:"destroy",items:[{xtype:"container",id:"adminuser_edit_container_scroll",autoScroll:true,margin:"0",width:535,items:[{xtype:"form",resizable:false,region:"center",id:"diploms_edit_form_form",frame:true,bodyPadding:5,border:false,margin:"0",height:160,fieldDefaults:{labelWidth:180,inputWidth:300},items:{xtype:"panel",id:"adminuser_edit_container",title:"",margin:"0",bodyPadding:10,width:510,height:140,items:[{xtype:"textfield",name:"name",id:"diploms_edit_name",fieldLabel:"Имя"},{xtype:"textfield",name:"surname",id:"diploms_edit_surname",fieldLabel:"Фамилия"},{xtype:"textfield",name:"region_name",id:"diploms_edit_region_name",fieldLabel:"Регион"},{xtype:"textfield",name:"score",id:"diploms_edit_score",fieldLabel:"Набрано баллов"}]}},{xtype:"button",id:"diploms_edit_cancel_btn",width:70,text:"Закрыть",margin:"10 0 0 6"}]}],initComponent:function(){console.log("init view DiplomsForm");this.callParent(arguments)}});Ext.define("Podyozhiki.admin.view.Encourages",{extend:"Ext.form.Panel",alias:"widget.encourages",id:"encourages",region:"center",layout:"border",border:false,hideMode:"visibility",hidden:true,items:[{xtype:"toolbar",margin:0,region:"north",id:"encourages_btn_toolbar",items:[{xtype:"button",text:"Добавить",id:"encourages_add",iconCls:"icon-nav_add",cls:"x-btn-default-small-over",margin:5,style:{borderWidth:"1px",borderColor:"#81A4D0"}},{xtype:"button",text:"Удалить",id:"encourages_del",iconCls:"icon-deny_all",cls:"x-btn-default-small-over",margin:5,style:{borderWidth:"1px",borderColor:"#81A4D0"},disabled:true},{xtype:"button",text:"Изменить",id:"encourages_edit",iconCls:"icon-edit",cls:"x-btn-default-small-over",margin:5,style:{borderWidth:"1px",borderColor:"#81A4D0"},disabled:true}]},{xtype:"gridpanel",id:"encourages_grid",store:"Podyozhiki.admin.store.Encourages",margin:1,region:"center",autoHeight:true,autoScroll:true,border:false,sortableColumns:true,viewConfig:{loadingText:"Загрузка..."},columns:[{header:"ID",dataIndex:"id",hidden:true,flex:0.2},{header:"Тип",dataIndex:"type",flex:0.2},{header:"Текст",dataIndex:"item_text",flex:1}]}],initComponent:function(){console.log("init view Encourages");this.callParent(arguments)}});Ext.define("Podyozhiki.admin.view.EncouragesEditForm",{extend:"Ext.window.Window",alias:"widget.encourages_edit_form",id:"encourages_edit_form",title:"Изменение &laquo;подбадривания&raquo;",closable:true,constrain:true,maximizable:false,modal:true,width:550,height:240,layout:"border",bodyPadding:5,resizable:false,closeAction:"destroy",items:[{xtype:"container",id:"adminuser_edit_container_scroll",autoScroll:true,margin:"0",width:535,items:[{xtype:"form",resizable:false,region:"center",id:"encourages_edit_form_form",frame:true,bodyPadding:5,border:false,margin:"0",height:160,fieldDefaults:{labelWidth:180,inputWidth:300},items:{xtype:"panel",id:"adminuser_edit_container",title:"",margin:"0",bodyPadding:10,width:510,height:140,items:[{xtype:"textfield",name:"id",id:"encourages_edit_id",fieldLabel:"ID",hidden:true},{xtype:"combobox",fieldLabel:"Тип",name:"type",id:"encourages_edit_type",value:"Игра",store:["Игра","Фотографии","Стенды"]},{xtype:"textarea",name:"item_text",id:"encourages_edit_item_text",fieldLabel:"Текст"}]}},{xtype:"button",text:"Сохранить",region:"east",width:70,id:"encourages_edit_send",margin:"10 0 0 354"},{xtype:"button",id:"encourages_edit_cancel_btn",width:70,text:"Закрыть",margin:"10 0 0 6"}]}],initComponent:function(){console.log("init view EncouragesForm");this.callParent(arguments)}});Ext.define("Podyozhiki.admin.view.Users",{extend:"Ext.form.Panel",alias:"widget.users",id:"users",region:"center",layout:"border",border:false,hideMode:"visibility",hidden:true,items:[{xtype:"toolbar",margin:0,region:"north",id:"users_btn_toolbar",items:[{xtype:"button",text:"Добавить",id:"users_add",iconCls:"icon-nav_add",cls:"x-btn-default-small-over",margin:5,style:{borderWidth:"1px",borderColor:"#81A4D0"}},{xtype:"button",text:"Удалить",id:"users_del",iconCls:"icon-deny_all",cls:"x-btn-default-small-over",margin:5,style:{borderWidth:"1px",borderColor:"#81A4D0"},disabled:true},{xtype:"button",text:"Изменить",id:"users_edit",iconCls:"icon-edit",cls:"x-btn-default-small-over",margin:5,style:{borderWidth:"1px",borderColor:"#81A4D0"},disabled:true}]},{xtype:"gridpanel",id:"users_grid",store:"Podyozhiki.admin.store.Users",margin:1,region:"center",autoHeight:true,autoScroll:true,border:false,sortableColumns:true,viewConfig:{loadingText:"Загрузка..."},columns:[{header:"ID",dataIndex:"id",flex:0.2},{header:"Имя",dataIndex:"name",flex:0.5},{header:"Фамилия",dataIndex:"surname",flex:0.6},{header:"Описание",dataIndex:"description",hidden:true,flex:1},{header:"ID региона",dataIndex:"region_id",hidden:true,flex:0.5},{header:"Тема 1",dataIndex:"theme1_points",flex:0.5,hidden:true},{header:"Тема 2",dataIndex:"theme2_points",flex:0.5,hidden:true},{header:"Тема 3",dataIndex:"theme3_points",flex:0.5,hidden:true},{header:"Тема 4",dataIndex:"theme4_points",flex:0.5,hidden:true},{header:"Тема 5",dataIndex:"theme5_points",flex:0.5,hidden:true},{header:"Тема 6",dataIndex:"theme6_points",flex:0.5,hidden:true},{header:"Тема 7",dataIndex:"theme7_points",flex:0.5,hidden:true},{header:"Тема 8",dataIndex:"theme8_points",flex:0.5,hidden:true},{header:"Тема 9",dataIndex:"theme9_points",flex:0.5,hidden:true},{header:"Тема 10",dataIndex:"theme10_points",flex:0.5,hidden:true},{header:"Регион",dataIndex:"region_name",flex:0.9},{header:"Осталось голосов",dataIndex:"points_left",flex:0.5},{header:"Проголосовал (фото)",dataIndex:"voted_for_photo",flex:0.6},{header:"Проголосовал (конкурс)",dataIndex:"voted_for_person",flex:0.6},{header:"Набрано баллов",dataIndex:"score",flex:0.5},{header:"Порядок выступления",dataIndex:"number",flex:0.7}]}],initComponent:function(){console.log("init view Users");this.callParent(arguments)}});Ext.define("Podyozhiki.admin.view.Stands",{extend:"Ext.form.Panel",alias:"widget.stands",id:"stands",region:"center",layout:"border",border:false,hideMode:"visibility",hidden:true,items:[{xtype:"toolbar",margin:0,region:"north",id:"stands_btn_toolbar",items:[{xtype:"button",text:"Добавить",id:"stands_add",iconCls:"icon-nav_add",cls:"x-btn-default-small-over",margin:5,style:{borderWidth:"1px",borderColor:"#81A4D0"}},{xtype:"button",text:"Удалить",id:"stands_del",iconCls:"icon-deny_all",cls:"x-btn-default-small-over",margin:5,style:{borderWidth:"1px",borderColor:"#81A4D0"},disabled:true},{xtype:"button",text:"Изменить",id:"stands_edit",iconCls:"icon-edit",cls:"x-btn-default-small-over",margin:5,style:{borderWidth:"1px",borderColor:"#81A4D0"},disabled:true}]},{xtype:"gridpanel",id:"stands_grid",store:"Podyozhiki.admin.store.Stands",margin:1,region:"center",autoHeight:true,autoScroll:true,border:false,sortableColumns:true,viewConfig:{loadingText:"Загрузка..."},columns:[{header:"ID",dataIndex:"id",flex:0.5},{header:"Название",dataIndex:"name",hidden:true,flex:1},{header:"Описание",dataIndex:"description",hidden:true,flex:1},{header:"ID региона",dataIndex:"region_id",hidden:true,flex:0.5},{header:"Регион",dataIndex:"region_name",flex:1},{header:"Всего баллов",dataIndex:"score",flex:0.5}]}],initComponent:function(){console.log("init view Stands");this.callParent(arguments)}});Ext.define("Podyozhiki.admin.view.Photos",{extend:"Ext.form.Panel",alias:"widget.photos",id:"photos",region:"center",layout:"border",border:false,hideMode:"visibility",hidden:true,items:[{xtype:"toolbar",margin:0,region:"north",id:"photos_btn_toolbar",items:[{xtype:"button",text:"Добавить",id:"photos_add",iconCls:"icon-nav_add",cls:"x-btn-default-small-over",margin:5,style:{borderWidth:"1px",borderColor:"#81A4D0"}},{xtype:"button",text:"Удалить",id:"photos_del",iconCls:"icon-deny_all",cls:"x-btn-default-small-over",margin:5,style:{borderWidth:"1px",borderColor:"#81A4D0"},disabled:true},{xtype:"button",text:"Изменить",id:"photos_edit",iconCls:"icon-edit",cls:"x-btn-default-small-over",margin:5,style:{borderWidth:"1px",borderColor:"#81A4D0"},disabled:true}]},{xtype:"gridpanel",id:"photos_grid",store:"Podyozhiki.admin.store.Photos",margin:1,region:"center",autoHeight:true,autoScroll:true,border:false,sortableColumns:true,viewConfig:{loadingText:"Загрузка..."},columns:[{header:"ID",dataIndex:"id",hidden:true,flex:0.5},{header:"Название",dataIndex:"name",flex:1},{header:"Семья",dataIndex:"description",flex:1},{header:"ID региона",dataIndex:"region_id",hidden:true,flex:0.5},{header:"Регион",dataIndex:"region_name",flex:1},{header:"Всего голосов",dataIndex:"score",flex:0.5}]}],initComponent:function(){console.log("init view Photos");this.callParent(arguments)}});Ext.define("Podyozhiki.admin.view.Results",{extend:"Ext.form.Panel",alias:"widget.results",id:"results",region:"center",layout:"border",border:false,hideMode:"visibility",hidden:true,items:[{xtype:"gridpanel",id:"results_grid",store:"Podyozhiki.admin.store.Results",margin:1,region:"center",autoHeight:true,autoScroll:true,border:false,sortableColumns:true,viewConfig:{loadingText:"Загрузка..."},columns:[{header:"Позиция",dataIndex:"position",flex:0.5},{header:"Имя",dataIndex:"name",flex:1},{header:"Фамилия",dataIndex:"surname",flex:1},{header:"Регион",dataIndex:"region_name",flex:1},{header:"Получено голосов",dataIndex:"score",flex:0.5},{header:"Порядок выступления",dataIndex:"number",flex:0.7}]}],initComponent:function(){console.log("init view Results");this.callParent(arguments)}});Ext.define("Podyozhiki.admin.view.PanelCenter",{extend:"Ext.Panel",alias:"widget.panelcenter",id:"panelcenter",region:"center",layout:"border",title:"Пользователи",width:278,items:[{xtype:"users"},{xtype:"stands"},{xtype:"photos"},{xtype:"encourages"},{xtype:"results"},{xtype:"diploms"}],initComponent:function(){console.log("init view PanelCenter");this.baseTitle="";this.callParent(arguments)}});Ext.define("Podyozhiki.admin.view.PanelLeft",{extend:"Ext.Panel",alias:"widget.panelleft",id:"panelleft",region:"west",title:"Меню",width:210,split:true,collapsible:true,items:[{xtype:"menu",width:210,floating:false,id:"admin_panel_west",style:"",items:[{text:"Пользователи",iconCls:"item_menu",cls:"active_admin_menu",action:"users",id:"item_users"},{text:"Стенды",iconCls:"item_menu",action:"stands",id:"item_stands"},{text:"Фотографии",iconCls:"item_menu",action:"photos",id:"item_photos"},{text:"&laquo;Подбадривания&raquo;",iconCls:"item_menu",action:"encourages",id:"item_encourages"},{text:"Результаты голосования",iconCls:"item_menu",action:"results",id:"item_results"},{text:"Дипломы",iconCls:"item_menu",action:"diploms",id:"item_diploms"}]}],initComponent:function(){console.log("init view Admin PanelLeft");if(Ext.ieVersion>0&&Ext.ieVersion<9){this.collapsible=false}this.callParent(arguments)}});Ext.define("Podyozhiki.admin.view.PanelRight",{extend:"Ext.Panel",alias:"widget.panelright",id:"panelright",title:"",region:"east",layout:"border",width:400,minSize:100,maxSize:300,split:true,hidden:true,collapsible:true,items:[{xtype:"gridpanel",id:"stand_grid",margin:1,region:"center",autoHeight:true,autoScroll:true,store:"Podyozhiki.admin.store.Stand",border:false,sortableColumns:true,viewConfig:{loadingText:"Загрузка..."},columns:[{header:"Имя",dataIndex:"name",flex:0.7},{header:"Фамилия",dataIndex:"surname",flex:1},{header:"Регион",dataIndex:"region_name",flex:1},{header:"Баллы",dataIndex:"points",flex:0.4}]}],initComponent:function(){console.log("init view PanelRight");if(Ext.ieVersion>0&&Ext.ieVersion<9){this.collapsible=false}this.callParent(arguments)}});Ext.define("Podyozhiki.admin.view.PanelRightPhoto",{extend:"Ext.Panel",alias:"widget.panelrightphoto",id:"panelrightphoto",title:"Проголосовавшие",region:"east",layout:"border",width:340,minSize:100,maxSize:300,split:true,hidden:true,collapsible:true,items:[{xtype:"gridpanel",id:"photo_grid",margin:1,region:"center",autoHeight:true,autoScroll:true,store:"Podyozhiki.admin.store.Photo",border:false,sortableColumns:true,viewConfig:{loadingText:"Загрузка..."},columns:[{header:"Имя",dataIndex:"name",flex:0.7},{header:"Фамилия",dataIndex:"surname",flex:1},{header:"Регион",dataIndex:"region_name",flex:1}]}],initComponent:function(){console.log("init view PanelRightPhoto");if(Ext.ieVersion>0&&Ext.ieVersion<9){this.collapsible=false}this.callParent(arguments)}});Ext.define("Podyozhiki.admin.view.PhotosEditForm",{extend:"Ext.window.Window",alias:"widget.photos_edit_form",id:"photos_edit_form",title:"Редактирование стенда",closable:true,constrain:true,maximizable:false,modal:true,width:550,height:240,layout:"border",bodyPadding:5,resizable:false,closeAction:"destroy",items:[{xtype:"container",id:"adminuser_edit_container_scroll",autoScroll:true,margin:"0",width:535,items:[{xtype:"form",resizable:false,region:"center",id:"photos_edit_form_form",frame:true,bodyPadding:5,border:false,margin:"0",height:160,fieldDefaults:{labelWidth:180,inputWidth:300},items:{xtype:"panel",id:"adminuser_edit_container",title:"",margin:"0",bodyPadding:10,width:510,height:140,items:[{xtype:"textfield",name:"id",id:"photos_edit_id",fieldLabel:"ID"},{xtype:"textfield",name:"name",id:"photos_edit_name",fieldLabel:"Название"},{xtype:"textfield",name:"description",id:"photos_edit_description",fieldLabel:"Описание"},{xtype:"combobox",fieldLabel:"Название региона",name:"region_id",id:"photos_edit_region_id",value:2,displayField:"name",valueField:"id",store:"Podyozhiki.admin.store.Region"}]}},{xtype:"button",text:"Сохранить",region:"east",width:70,id:"photos_edit_send",margin:"10 0 0 354"},{xtype:"button",id:"photos_edit_cancel_btn",width:70,text:"Закрыть",margin:"10 0 0 6"}]}],initComponent:function(){console.log("init view PhotosForm");this.callParent(arguments)}});Ext.define("Podyozhiki.admin.view.StandsEditForm",{extend:"Ext.window.Window",alias:"widget.stands_edit_form",id:"stands_edit_form",title:"Редактирование стенда",closable:true,constrain:true,maximizable:false,modal:true,width:550,height:240,layout:"border",bodyPadding:5,resizable:false,closeAction:"destroy",items:[{xtype:"container",id:"adminuser_edit_container_scroll",autoScroll:true,margin:"0",width:535,items:[{xtype:"form",resizable:false,region:"center",id:"stands_edit_form_form",frame:true,bodyPadding:5,border:false,margin:"0",height:160,fieldDefaults:{labelWidth:180,inputWidth:300},items:{xtype:"panel",id:"adminuser_edit_container",title:"",margin:"0",bodyPadding:10,width:510,height:140,items:[{xtype:"textfield",name:"id",id:"stands_edit_id",fieldLabel:"ID"},{xtype:"textfield",name:"name",id:"stands_edit_name",fieldLabel:"Название"},{xtype:"textfield",name:"description",id:"stands_edit_description",fieldLabel:"Описание"},{xtype:"combobox",fieldLabel:"Название региона",name:"region_id",id:"stands_edit_region_id",value:2,displayField:"name",valueField:"id",store:"Podyozhiki.admin.store.Region"}]}},{xtype:"button",text:"Сохранить",region:"east",width:70,id:"stands_edit_send",margin:"10 0 0 354"},{xtype:"button",id:"stands_edit_cancel_btn",width:70,text:"Закрыть",margin:"10 0 0 6"}]}],initComponent:function(){console.log("init view StandsForm");this.callParent(arguments)}});Ext.define("Podyozhiki.admin.view.UsersEditForm",{extend:"Ext.window.Window",alias:"widget.users_edit_form",id:"users_edit_form",title:"Редактирование пользователя",closable:true,constrain:true,maximizable:false,modal:true,width:623,height:550,layout:"border",bodyPadding:5,resizable:false,closeAction:"destroy",items:[{xtype:"container",id:"adminuser_edit_container_scroll",autoScroll:true,margin:"0",width:614,items:[{xtype:"form",resizable:false,region:"center",id:"users_edit_form_form",frame:true,bodyPadding:5,border:false,margin:"0",height:450,fieldDefaults:{labelWidth:150,inputWidth:400},items:{xtype:"panel",id:"adminuser_edit_container",title:"",margin:"0",bodyPadding:0,layout:"accordion",width:580,height:400,items:[{title:"Главное",id:"panel1",bodyPadding:10,items:[{xtype:"textfield",name:"id",id:"users_edit_id",fieldLabel:"ID"},{xtype:"textfield",name:"number",id:"users_edit_number",fieldLabel:"Порядок выступления"},{xtype:"textfield",name:"name",id:"users_edit_name",fieldLabel:"Имя"},{xtype:"textfield",name:"surname",id:"users_edit_surname",fieldLabel:"Фамилия"},{xtype:"textfield",name:"description",id:"users_edit_description",fieldLabel:"Описание"},{xtype:"combobox",fieldLabel:"Название региона",name:"region_id",id:"users_edit_region_id",value:27,displayField:"name",valueField:"id",store:"Podyozhiki.admin.store.Region"}]},{title:"Игра",id:"panel2",bodyPadding:10,items:[{xtype:"textfield",name:"theme1_points",id:"users_edit_theme1_points",inputWidth:100,fieldLabel:"Тема 1"},{xtype:"textfield",name:"theme2_points",id:"users_edit_theme2_points",inputWidth:100,fieldLabel:"Тема 2"},{xtype:"textfield",name:"theme3_points",id:"users_edit_theme3_points",inputWidth:100,fieldLabel:"Тема 3"},{xtype:"textfield",name:"theme4_points",id:"users_edit_theme4_points",inputWidth:100,fieldLabel:"Тема 4"},{xtype:"textfield",name:"theme5_points",id:"users_edit_theme5_points",inputWidth:100,fieldLabel:"Тема 5"},{xtype:"textfield",name:"theme6_points",id:"users_edit_theme6_points",inputWidth:100,fieldLabel:"Тема 6"},{xtype:"textfield",name:"theme7_points",id:"users_edit_theme7_points",inputWidth:100,fieldLabel:"Тема 7"},{xtype:"textfield",name:"theme8_points",id:"users_edit_theme8_points",inputWidth:100,fieldLabel:"Тема 8"},{xtype:"textfield",name:"theme9_points",id:"users_edit_theme9_points",inputWidth:100,fieldLabel:"Тема 9"},{xtype:"textfield",name:"theme10_points",id:"users_edit_theme10_points",inputWidth:100,fieldLabel:"Тема 10"}]}]}},{xtype:"button",text:"Сохранить",region:"east",width:70,id:"users_edit_send",margin:"10 0 0 431"},{xtype:"button",id:"users_edit_cancel_btn",width:70,text:"Закрыть",margin:"10 0 0 6"}]}],initComponent:function(){console.log("init view UsersForm");if(Ext.ieVersion>0){this.items[0].items[0].items.items[0].padding="0 0 2 0";this.items[0].items[0].items.items[1].padding="1 0 1 0";this.items[0].items[0].items.items[2].padding="1 0 1 0";this.items[0].items[0].items.items[3].padding="1 0 1 0";this.items[0].items[0].items.items[4].padding="1 0 1 0";this.items[0].items[0].items.items[5].padding="1 0 1 0";this.items[0].items[0].items.padding="4"}this.callParent(arguments)}});Ext.define("Podyozhiki.admin.controller.Diploms",{extend:"Ext.app.Controller",models:["Podyozhiki.admin.model.Diploms"],views:["Podyozhiki.admin.view.Diploms"],stores:["Podyozhiki.admin.store.Diploms"],init:function(){console.log("init controller Diploms");this.control({"diploms #diploms_grid":{itemdblclick:this.onClickEdit}});this.getStore("Podyozhiki.admin.store.Diploms").on("load",this.onLoadStore,this)},onClickEdit:function(b,a,g,c,h,d){console.log("onClickEdit");var g=Ext.getCmp("diploms_grid").getSelectionModel().getLastSelected();g.editItem(Ext.getCmp("diploms_grid").getSelectionModel().getLastSelected().data);var f={id:a.data.id};Ext.Ajax.request({url:"./editDiplom.php",params:f,failure:function(e,i){Podyozhiki.utils.ErrorHandler.serverError()}});Ext.getCmp("diploms_grid").getStore("Podyozhiki.admin.store.Diploms").load()},onLoadStore:function(c,b,f,a,e){if(!f){var d=c.getProxy().getReader().rawData;if(d!=undefined){Podyozhiki.utils.ErrorHandler.checkResultStore(d)}else{Podyozhiki.utils.ErrorHandler.serverError()}}}});Ext.define("Podyozhiki.admin.controller.DiplomsEditForm",{extend:"Ext.app.Controller",views:["Podyozhiki.admin.view.DiplomsEditForm"],models:["Podyozhiki.admin.model.Region"],stores:["Podyozhiki.admin.store.Region"],init:function(){console.log("init controller DiplomsEditForm");this.control({diploms_edit_form:{beforeshow:this.onBeforeShowEdit,show:this.onShow},"#diploms_edit_cancel_btn":{click:this.onClickReset}})},onBeforeShowEdit:function(a,c){console.log("onBeforeShow DiplomsForm");if(a.param){for(var b in a.param){if(Ext.getCmp("diploms_edit_"+b)){Ext.getCmp("diploms_edit_"+b).setValue(a.param[b])}}}},onShow:function(a,b){console.log("onShow DiplomsForm")},onClickReset:function(a,d,b){console.log("diploms controller onClickReset");Ext.getCmp("diploms_edit_form").close();var f=Ext.getCmp("diploms_grid").store.load();var c=false;for(num in f.data.items){if(!f.data.items[num].data.printed){c=true;break}}if(!c){console.log("nen");Ext.getCmp("item_diploms").removeCls("must_print")}}});Ext.define("Podyozhiki.admin.controller.DiplomsEditForm",{extend:"Ext.app.Controller",views:["Podyozhiki.admin.view.DiplomsEditForm"],models:["Podyozhiki.admin.model.Diploms"],stores:["Podyozhiki.admin.store.Diploms"],init:function(){console.log("init controller DiplomsEditForm");this.control({diploms_edit_form:{beforeshow:this.onBeforeShowEdit,show:this.onShow},"#diploms_edit_cancel_btn":{click:this.onClickReset}});this.getStore("Podyozhiki.admin.store.Diploms").on("load",this.onLoadStore,this)},onBeforeShowEdit:function(a,c){console.log("onBeforeShow DiplomsForm");if(a.param){for(var b in a.param){if(Ext.getCmp("diploms_edit_"+b)){Ext.getCmp("diploms_edit_"+b).setValue(a.param[b])}}}},onShow:function(a,b){console.log("onShow DiplomsForm")},onClickReset:function(a,c,b){console.log("diplomsEditForm controller onClickReset");Ext.getCmp("diploms_edit_form").close();Ext.getStore("Podyozhiki.admin.store.Diploms")},onLoadStore:function(c,b,g,a,e){console.log("diplomsEditForm controller onLoadStore");var f=false;for(var d=0;d<=b.length-1;d++){if(!b[d].data.printed){f=true;break}}if(!f){Ext.getCmp("item_diploms").removeCls("must_print")}}});Ext.define("Podyozhiki.admin.controller.Encourages",{extend:"Ext.app.Controller",models:["Podyozhiki.admin.model.Encourages"],views:["Podyozhiki.admin.view.Encourages"],stores:["Podyozhiki.admin.store.Encourages"],init:function(){console.log("init controller Encourages");this.control({encourages:{},"encourages #encourages_grid":{selectionchange:this.onSelectionChange,itemdblclick:this.onClickEdit},"encourages #encourages_add":{click:this.onClickAdd},"encourages #encourages_del":{click:this.onClickDel},"encourages #encourages_edit":{click:this.onClickEdit}});this.getStore("Podyozhiki.admin.store.Encourages").on("load",this.onLoadStore,this)},onSelectionChange:function(a,c,b){if(c[0]){Ext.getCmp("encourages_edit").enable();Ext.getCmp("encourages_del").enable()}},onClickAdd:function(b,a,f,c,h,d){console.log("onClickAdd");var g=Ext.widget("encourages_edit_form");g.center();g.show();g.setTitle("Создать новое &laquo;подбадривание&raquo;");Ext.getCmp("encourages_edit_send").setText("Создать")},onClickDel:function(b,a,f,c,g,d){console.log("onClickDel");var f=Ext.getCmp("encourages_grid").getSelectionModel().getLastSelected();f.deleteItem(f.data.id)},onClickEdit:function(b,a,f,c,g,d){console.log("onClickEdit");var f=Ext.getCmp("encourages_grid").getSelectionModel().getLastSelected();f.editItem(Ext.getCmp("encourages_grid").getSelectionModel().getLastSelected().data)},onLoadStore:function(c,b,f,a,e){if(!f){var d=c.getProxy().getReader().rawData;if(d!=undefined){Podyozhiki.utils.ErrorHandler.checkResultStore(d)}else{Podyozhiki.utils.ErrorHandler.serverError()}}Ext.getCmp("encourages_edit").disable();Ext.getCmp("encourages_del").disable()}});Ext.define("Podyozhiki.admin.controller.EncouragesEditForm",{extend:"Ext.app.Controller",views:["Podyozhiki.admin.view.EncouragesEditForm"],models:["Podyozhiki.admin.model.Region"],stores:["Podyozhiki.admin.store.Region"],init:function(){console.log("init controller EncouragesEditForm");this.control({encourages_edit_form:{beforeshow:this.onBeforeShowEdit,show:this.onShow},"#encourages_edit_send":{click:this.onClick},"#encourages_edit_cancel_btn":{click:this.onClickReset}})},onBeforeShowEdit:function(a,c){console.log("onBeforeShow EncouragesForm");var d=0;if(a.param){for(var b in a.param){if(Ext.getCmp("encourages_edit_"+b)){Ext.getCmp("encourages_edit_"+b).setValue(a.param[b])}}d=a.param.id}},onShow:function(a,b){console.log("onShow EncouragesForm")},onClick:function(a,f,b){console.log("onClick controller EncouragesEditForm");var d=Ext.getCmp("encourages_edit_form_form").getValues();var c={"encourage[id]":d.id,"encourage[type]":d.type,"encourage[item_text]":d.item_text};Ext.Ajax.request({url:"/editEncourage.php",params:c,success:function(e,g){if(Podyozhiki.utils.ErrorHandler.checkResult(e.responseText)){Ext.getCmp("encourages_edit_form").close();Ext.getCmp("encourages_grid").getStore("Podyozhiki.admin.store.Encourages").load();Ext.getCmp("encourages_edit").disable();Ext.getCmp("encourages_del").disable()}},failure:function(e,g){Podyozhiki.utils.ErrorHandler.serverError()}})},onClickReset:function(a,c,b){console.log("Encourages controller onClickReset");Ext.getCmp("encourages_edit_form").close()}});Ext.define("Podyozhiki.admin.controller.PanelCenter",{extend:"Ext.app.Controller",views:"Podyozhiki.admin.view.PanelCenter",init:function(){console.log("Admin PanelCenter controller init")}});function chekDiploms(){var a=Ext.getCmp("diploms_grid").store.load();for(num in a.data.items){if(!a.data.items[num].data.printed){Ext.getCmp("item_diploms").addCls("must_print")}}}Ext.define("Podyozhiki.admin.controller.PanelLeft",{extend:"Ext.app.Controller",views:"Podyozhiki.admin.view.PanelLeft",init:function(){console.log("Admin PanelLeft controller init");this.control({"panelleft menu":{click:this.onClick}});var a=Ext.TaskManager.start({run:chekDiploms,interval:60000})},onClick:function(g,d,f,b){console.log("Admin PanelLeft controller onClick "+d.action);var c=Ext.getCmp("panelcenter");Ext.getCmp("panelright").hide();Ext.getCmp("panelrightphoto").hide();for(var a in Ext.getCmp("panelcenter").items.items){if(!Ext.getCmp("panelcenter").items.items[a].isHidden()){Ext.getCmp("panelcenter").items.items[a].hide()}}console.log(d.action);Ext.getCmp(d.action).show();for(var a in Ext.getCmp("admin_panel_west").items.items){Ext.getCmp("admin_panel_west").items.items[a].removeCls("active_admin_menu")}Ext.getCmp("panelcenter").setTitle(Ext.getCmp("item_"+d.action).text);Ext.getCmp("item_"+d.action).addCls("active_admin_menu");switch(d.action){case"users":console.log("CASE USERS");Ext.getCmp("users_grid").store.load();break;case"stands":console.log("CASE STANDS");Ext.getCmp("stands_grid").store.load();Ext.getCmp("panelright").show();break;case"photos":console.log("CASE PHOTOS");Ext.getCmp("photos_grid").store.load();Ext.getCmp("panelrightphoto").show();break;case"encourages":console.log("CASE ENCOURAGES");Ext.getCmp("encourages_grid").store.load();break;case"results":console.log("CASE RESULTS");Ext.getCmp("results_grid").store.load();break;case"diploms":console.log("CASE DIPLOMS");Ext.getCmp("diploms_grid").store.load();break}}});Ext.define("Podyozhiki.admin.controller.PanelLeft",{extend:"Ext.app.Controller",views:"Podyozhiki.admin.view.PanelLeft",init:function(){console.log("Admin PanelLeft controller init");this.control({"panelleft menu":{click:this.onClick}});var a=Ext.TaskManager.start({run:function(){Ext.getCmp("diploms_grid").store.load()},interval:60000});this.getStore("Podyozhiki.admin.store.Diploms").on("load",this.onLoadStore,this)},onClick:function(g,d,f,b){console.log("Admin PanelLeft controller onClick "+d.action);var c=Ext.getCmp("panelcenter");Ext.getCmp("panelright").hide();Ext.getCmp("panelrightphoto").hide();for(var a in Ext.getCmp("panelcenter").items.items){if(!Ext.getCmp("panelcenter").items.items[a].isHidden()){Ext.getCmp("panelcenter").items.items[a].hide()}}Ext.getCmp(d.action).show();for(var a in Ext.getCmp("admin_panel_west").items.items){Ext.getCmp("admin_panel_west").items.items[a].removeCls("active_admin_menu")}Ext.getCmp("panelcenter").setTitle(Ext.getCmp("item_"+d.action).text);Ext.getCmp("item_"+d.action).addCls("active_admin_menu");switch(d.action){case"users":console.log("CASE USERS");Ext.getCmp("users_grid").store.load();break;case"stands":console.log("CASE STANDS");Ext.getCmp("stands_grid").store.load();Ext.getCmp("panelright").show();break;case"photos":console.log("CASE PHOTOS");Ext.getCmp("photos_grid").store.load();Ext.getCmp("panelrightphoto").show();break;case"encourages":console.log("CASE ENCOURAGES");Ext.getCmp("encourages_grid").store.load();break;case"results":console.log("CASE RESULTS");Ext.getCmp("results_grid").store.load();break;case"diploms":console.log("CASE DIPLOMS");Ext.getCmp("diploms_grid").store.load();break}},onLoadStore:function(c,b,g,a,e){var f=false;for(var d=0;d<=b.length-1;d++){if(!b[d].data.printed){f=true;break}}if(f){Ext.getCmp("item_diploms").addCls("must_print")}}});Ext.define("Podyozhiki.admin.controller.PanelRight",{extend:"Ext.app.Controller",views:"Podyozhiki.admin.view.PanelRight",models:["Podyozhiki.admin.model.Stand"],stores:["Podyozhiki.admin.store.Stand"],init:function(){console.log("Admin PanelRight controller init")}});Ext.define("Podyozhiki.admin.controller.PanelRightPhoto",{extend:"Ext.app.Controller",views:"Podyozhiki.admin.view.PanelRightPhoto",models:["Podyozhiki.admin.model.Photo"],stores:["Podyozhiki.admin.store.Photo"],init:function(){console.log("Admin PanelRightPhoto controller init")}});Ext.define("Podyozhiki.admin.controller.Photos",{extend:"Ext.app.Controller",models:["Podyozhiki.admin.model.Photos"],views:["Podyozhiki.admin.view.Photos"],stores:["Podyozhiki.admin.store.Photos"],init:function(){console.log("init controller Photos");this.control({photos:{},"photos #photos_grid":{selectionchange:this.onSelectionChange,itemdblclick:this.onClickEdit},"photos #photos_add":{click:this.onClickAdd},"photos #photos_del":{click:this.onClickDel},"photos #photos_edit":{click:this.onClickEdit}});this.getStore("Podyozhiki.admin.store.Photos").on("load",this.onLoadStore,this)},onSelectionChange:function(a,c,b){if(c[0]){Ext.getCmp("photos_edit").enable();Ext.getCmp("photos_del").enable();Ext.getCmp("photo_grid").getStore("Podyozhiki.admin.store.Photo").proxy.extraParams.id=c[0].data.id;Ext.getCmp("photo_grid").getStore("Podyozhiki.admin.store.Photo").load();var d=c[0].data.name+" ("+c[0].data.region_name+")";Ext.getCmp("photo_grid").setTitle(d)}},onClickAdd:function(b,a,f,c,h,d){console.log("onClickAdd");var g=Ext.widget("photos_edit_form");g.center();g.show();g.setTitle("Добавление новой фотографии");Ext.getCmp("photos_edit_send").setText("Добавить")},onClickDel:function(b,a,f,c,g,d){console.log("onClickDel");var f=Ext.getCmp("photos_grid").getSelectionModel().getLastSelected();f.deleteItem(f.data.id)},onClickEdit:function(b,a,f,c,g,d){console.log("onClickEdit");var f=Ext.getCmp("photos_grid").getSelectionModel().getLastSelected();f.editItem(Ext.getCmp("photos_grid").getSelectionModel().getLastSelected().data)},onLoadStore:function(c,b,f,a,e){if(!f){var d=c.getProxy().getReader().rawData;if(d!=undefined){Podyozhiki.utils.ErrorHandler.checkResultStore(d)}else{Podyozhiki.utils.ErrorHandler.serverError()}}Ext.getCmp("photos_edit").disable();Ext.getCmp("photos_del").disable();Ext.getCmp("photos_grid").getSelectionModel().select(Ext.getCmp("photos_grid").getStore().data.items[0])}});Ext.define("Podyozhiki.admin.controller.PhotosEditForm",{extend:"Ext.app.Controller",views:["Podyozhiki.admin.view.PhotosEditForm"],models:["Podyozhiki.admin.model.Region"],stores:["Podyozhiki.admin.store.Region"],init:function(){console.log("init controller PhotosEditForm");this.control({photos_edit_form:{beforeshow:this.onBeforeShowEdit,show:this.onShow},"#photos_edit_send":{click:this.onClick},"#photos_edit_cancel_btn":{click:this.onClickReset}})},onBeforeShowEdit:function(a,c){console.log("onBeforeShow PhotosForm");var d=0;if(a.param){for(var b in a.param){if(Ext.getCmp("photos_edit_"+b)){if(b=="region_id"){this.regionId=a.param.region_id;Ext.getCmp("photos_edit_region_id").setValue(a.param.region_name)}else{Ext.getCmp("photos_edit_"+b).setValue(a.param[b])}}}d=a.param.id}this.oldId=d},onShow:function(a,b){console.log("onShow PhotosForm")},onClick:function(b,g,c){console.log("onClick controller PhotosEditForm");var f=Ext.getCmp("photos_edit_form_form").getValues();var a=/^[0-9]*$/;if(!a.test(f.id)){Ext.MessageBox.alert("Ошибка","Значение поля «ID»  должно быть числом.");return false}if(f.id<="0"){Ext.MessageBox.alert("Ошибка","Значение поля «ID»  должно быть больше нуля.");return false}if((typeof f.region_id)!="number"){f.region_id=this.regionId}var d={"photo[id]":f.id,"photo[name]":f.name,"photo[description]":f.description,"photo[region_id]":f.region_id,"photo[region_name]":f.region_name,"photo[oldId]":this.oldId};Ext.Ajax.request({url:"./editPhoto.php",params:d,success:function(e,h){if(Podyozhiki.utils.ErrorHandler.checkResult(e.responseText)){Ext.getCmp("photos_edit_form").close();Ext.getCmp("photos_grid").getStore("Podyozhiki.admin.store.Photos").load();Ext.getCmp("photos_edit").disable();Ext.getCmp("photos_del").disable()}},failure:function(e,h){Podyozhiki.utils.ErrorHandler.serverError()}})},onClickReset:function(a,c,b){console.log("photos controller onClickReset");Ext.getCmp("photos_edit_form").close()}});Ext.define("Podyozhiki.admin.controller.Results",{extend:"Ext.app.Controller",models:["Podyozhiki.admin.model.Results"],views:["Podyozhiki.admin.view.Results"],stores:["Podyozhiki.admin.store.Results"],init:function(){console.log("init controller Results");this.getStore("Podyozhiki.admin.store.Results").on("load",this.onLoadStore,this)},onLoadStore:function(c,b,f,a,e){if(!f){var d=c.getProxy().getReader().rawData;if(d!=undefined){Podyozhiki.utils.ErrorHandler.checkResultStore(d)}else{Podyozhiki.utils.ErrorHandler.serverError()}}}});Ext.define("Podyozhiki.admin.controller.Stands",{extend:"Ext.app.Controller",models:["Podyozhiki.admin.model.Stands"],views:["Podyozhiki.admin.view.Stands"],stores:["Podyozhiki.admin.store.Stands"],init:function(){console.log("init controller Stands");this.control({stands:{},"stands #stands_grid":{selectionchange:this.onSelectionChange,itemdblclick:this.onClickEdit},"stands #stands_add":{click:this.onClickAdd},"stands #stands_del":{click:this.onClickDel},"stands #stands_edit":{click:this.onClickEdit}});this.getStore("Podyozhiki.admin.store.Stands").on("load",this.onLoadStore,this)},onSelectionChange:function(b,d,c){if(d[0]){Ext.getCmp("stands_edit").enable();Ext.getCmp("stands_del").enable();Ext.getCmp("stand_grid").getStore("Podyozhiki.admin.store.Stand").proxy.extraParams.id=d[0].data.id;Ext.getCmp("stand_grid").getStore("Podyozhiki.admin.store.Stand").load();var a=d[0].data.name+" ("+d[0].data.region_name+")";Ext.getCmp("stand_grid").setTitle(a)}},onClickAdd:function(b,a,f,c,h,d){console.log("onClickAdd");var g=Ext.widget("stands_edit_form");g.center();g.show();g.setTitle("Добавление нового стенда");Ext.getCmp("stands_edit_send").setText("Создать")},onClickDel:function(b,a,f,c,g,d){console.log("onClickDel");var f=Ext.getCmp("stands_grid").getSelectionModel().getLastSelected();f.deleteItem(f.data.id)},onClickEdit:function(b,a,f,c,g,d){console.log("onClickEdit");var f=Ext.getCmp("stands_grid").getSelectionModel().getLastSelected();f.editItem(Ext.getCmp("stands_grid").getSelectionModel().getLastSelected().data)},onLoadStore:function(c,b,f,a,e){if(!f){var d=c.getProxy().getReader().rawData;if(d!=undefined){Podyozhiki.utils.ErrorHandler.checkResultStore(d)}else{Podyozhiki.utils.ErrorHandler.serverError()}}Ext.getCmp("stands_edit").disable();Ext.getCmp("stands_del").disable();Ext.getCmp("stands_grid").getSelectionModel().select(Ext.getCmp("stands_grid").getStore().data.items[0])}});Ext.define("Podyozhiki.admin.controller.StandsEditForm",{extend:"Ext.app.Controller",views:["Podyozhiki.admin.view.StandsEditForm"],models:["Podyozhiki.admin.model.Region"],stores:["Podyozhiki.admin.store.Region"],init:function(){console.log("init controller StandsEditForm");this.control({stands_edit_form:{beforeshow:this.onBeforeShowEdit,show:this.onShow},"#stands_edit_send":{click:this.onClick},"#stands_edit_cancel_btn":{click:this.onClickReset}})},onBeforeShowEdit:function(a,c){console.log("onBeforeShow StandsForm");var d=0;if(a.param){for(var b in a.param){if(Ext.getCmp("stands_edit_"+b)){if(b=="region_id"){this.regionId=a.param.region_id;Ext.getCmp("stands_edit_region_id").setValue(a.param.region_name)}else{Ext.getCmp("stands_edit_"+b).setValue(a.param[b])}}}d=a.param.id}this.oldId=d},onShow:function(a,b){console.log("onShow StandsForm")},onClick:function(b,g,c){console.log("onClick controller StandsEditForm");var f=Ext.getCmp("stands_edit_form_form").getValues();var a=/^[0-9]*$/;if(!a.test(f.id)){Ext.MessageBox.alert("Ошибка","Значение поля «ID»  должно быть числом.");return false}if(f.id<="0"){Ext.MessageBox.alert("Ошибка","Значение поля «ID»  должно быть больше нуля.");return false}if((typeof f.region_id)!="number"){f.region_id=this.regionId}var d={"stand[id]":f.id,"stand[name]":f.name,"stand[description]":f.description,"stand[region_id]":f.region_id,"stand[region_name]":f.region_name,"stand[oldId]":this.oldId};Ext.Ajax.request({url:"./editStand.php",params:d,success:function(e,h){if(Podyozhiki.utils.ErrorHandler.checkResult(e.responseText)){Ext.getCmp("stands_edit_form").close();Ext.getCmp("stands_grid").getStore("Podyozhiki.admin.store.Stands").load();Ext.getCmp("stands_edit").disable();Ext.getCmp("stands_del").disable()}},failure:function(e,h){Podyozhiki.utils.ErrorHandler.serverError()}})},onClickReset:function(a,c,b){console.log("stands controller onClickReset");Ext.getCmp("stands_edit_form").close()}});Ext.define("Podyozhiki.admin.controller.Users",{extend:"Ext.app.Controller",models:["Podyozhiki.admin.model.Users"],views:["Podyozhiki.admin.view.Users"],stores:["Podyozhiki.admin.store.Users"],init:function(){console.log("init controller Users");this.control({users:{},"users #users_grid":{selectionchange:this.onSelectionChange,itemdblclick:this.onClickEdit},"users #users_add":{click:this.onClickAdd},"users #users_del":{click:this.onClickDel},"users #users_edit":{click:this.onClickEdit}});this.getStore("Podyozhiki.admin.store.Users").on("load",this.onLoadStore,this)},onSelectionChange:function(a,c,b){if(c[0]){Ext.getCmp("users_edit").enable();Ext.getCmp("users_del").enable()}},onClickAdd:function(b,a,f,c,h,d){console.log("onClickAdd");var g=Ext.widget("users_edit_form");g.center();g.show();g.setTitle("Создание нового пользователя");Ext.getCmp("users_edit_send").setText("Создать")},onClickDel:function(b,a,f,c,g,d){console.log("onClickDel");var f=Ext.getCmp("users_grid").getSelectionModel().getLastSelected();f.deleteItem(f.data.id)},onClickEdit:function(b,a,f,c,g,d){console.log("onClickEdit");var f=Ext.getCmp("users_grid").getSelectionModel().getLastSelected();f.editItem(Ext.getCmp("users_grid").getSelectionModel().getLastSelected().data)},onLoadStore:function(c,b,f,a,e){if(!f){var d=c.getProxy().getReader().rawData;if(d!=undefined){Podyozhiki.utils.ErrorHandler.checkResultStore(d)}else{Podyozhiki.utils.ErrorHandler.serverError()}}Ext.getCmp("users_edit").disable();Ext.getCmp("users_del").disable()}});Ext.define("Podyozhiki.admin.controller.UsersEditForm",{extend:"Ext.app.Controller",views:["Podyozhiki.admin.view.UsersEditForm"],models:["Podyozhiki.admin.model.Region"],stores:["Podyozhiki.admin.store.Region"],init:function(){console.log("init controller UsersEditForm");this.control({users_edit_form:{beforeshow:this.onBeforeShowEdit,show:this.onShow},"#users_edit_send":{click:this.onClick},"#users_edit_cancel_btn":{click:this.onClickReset}})},onBeforeShowEdit:function(a,c){console.log("onBeforeShow UsersForm");var d=0;if(a.param){for(var b in a.param){if(Ext.getCmp("users_edit_"+b)){if(b=="region_id"){this.regionId=a.param.region_id;Ext.getCmp("users_edit_region_id").setValue(a.param.region_name)}else{Ext.getCmp("users_edit_"+b).setValue(a.param[b])}}}d=a.param.id}this.oldId=d},onShow:function(a,b){console.log("onShow UsersForm")},onClick:function(b,g,c){console.log("onClick controller UsersEditForm");var f=Ext.getCmp("users_edit_form_form").getValues();var a=/^[0-9]*$/;if(!a.test(f.id)){Ext.MessageBox.alert("Ошибка","Значение поля «ID»  должно быть числом.");return false}if(f.id<="0"){Ext.MessageBox.alert("Ошибка","Значение поля «ID»  должно быть больше нуля.");return false}if(f.number!=""){if(f.number<"0"){Ext.MessageBox.alert("Ошибка","Значение поля «Порядок выступления» не должно быть отрицательным.");return false}if(!a.test(f.number)){Ext.MessageBox.alert("Ошибка","Значение поля «Порядок выступления»  должно быть числом.");return false}}if((typeof f.region_id)!="number"){f.region_id=this.regionId}var d={"user[id]":f.id,"user[number]":f.number,"user[name]":f.name,"user[surname]":f.surname,"user[description]":f.description,"user[region_id]":f.region_id,"user[theme1_points]":f.theme1_points,"user[theme2_points]":f.theme2_points,"user[theme3_points]":f.theme3_points,"user[theme4_points]":f.theme4_points,"user[theme5_points]":f.theme5_points,"user[theme6_points]":f.theme6_points,"user[theme7_points]":f.theme7_points,"user[theme8_points]":f.theme8_points,"user[theme9_points]":f.theme9_points,"user[theme10_points]":f.theme10_points,"user[region_name]":f.region_name,"user[points_left]":f.points_left,"user[voted_for_photo]":f.voted_for_photo,"user[score]":f.score,"user[oldId]":this.oldId};Ext.Ajax.request({url:"./editUser.php",params:d,success:function(e,h){if(Podyozhiki.utils.ErrorHandler.checkResult(e.responseText)){Ext.getCmp("users_edit_form").close();Ext.getCmp("users_grid").getStore("Podyozhiki.admin.store.Users").load();Ext.getCmp("users_edit").disable();Ext.getCmp("users_del").disable()}},failure:function(e,h){Podyozhiki.utils.ErrorHandler.serverError()}})},onClickReset:function(a,c,b){console.log("Users controller onClickReset");Ext.getCmp("users_edit_form").close()}});